<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interactive Mindmap — Entrepreneurship Charter</title>

<!-- D3.js v7 -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
  :root{
    --bg:#f7fafc;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#0f172a;
    --accent-2:#0ea5a4;
  }
  html,body {height:100%; margin:0; font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); color:var(--accent);}
  .app {
    display:flex; height:100vh; gap:12px;
    padding:14px;
    box-sizing:border-box;
  }
  /* left: svg area, right: control panel */
  .canvas {
    flex:1 1 auto; background: linear-gradient(180deg,#fbfdff 0%, #f7fafc 100%); border-radius:12px; box-shadow: 0 6px 18px rgba(12,24,40,.06); padding:8px;
    overflow:hidden; position:relative;
  }
  svg { width:100%; height:100%; display:block; }
  .controls {
    width:360px; max-width:42%;
    flex:0 0 360px; background:var(--card); border-radius:12px; padding:14px; box-shadow: 0 8px 30px rgba(8,20,40,0.06); overflow:auto;
  }
  h2{margin:2px 0 8px 0; font-size:16px;}
  .btn {display:inline-block; padding:8px 10px; border-radius:8px; margin:6px 6px 6px 0; cursor:pointer; border:1px solid rgba(15,23,42,0.06); background:#fff; font-size:13px;}
  .btn.primary {background:var(--accent-2); color:white; border: none;}
  .search {width:100%; padding:8px 10px; border-radius:8px; border:1px solid #e6edf0; margin-bottom:10px;}
  .legend {font-size:13px; color:var(--muted)}
  .node-rect { fill: #fff; stroke: #e6edf0; stroke-width:1; rx:8; filter: drop-shadow(0 2px 6px rgba(2,6,23,0.06)); }
  .node-text { font-size:13px; pointer-events:none; }
  .node-title { font-weight:600; font-size:14px; }
  .link { fill:none; stroke:#cbd5e1; stroke-width:2; }
  .highlight { stroke: #0ea5a4 !important; stroke-width:3px !important; }
  .sidebar { margin-top:10px; font-size:14px; color:#111827; }
  .meta { font-size:13px; color:var(--muted); margin-top:6px; white-space:pre-wrap; }
  .small { font-size:12px; color:var(--muted); margin-top:8px; }
  .footer { font-size:12px; color:var(--muted); margin-top:12px; }
  a.inline { color:var(--accent-2); text-decoration:none; }
  /* responsive */
  @media (max-width:900px){
    .app {flex-direction:column;}
    .controls {width:100%; max-width:100%; order:2; height:320px;}
    .canvas {order:1; height:60vh;}
  }
</style>
</head>
<body>
<div class="app">
  <div class="canvas" id="canvas">
    <svg id="svg" role="img" aria-label="Interactive mindmap"></svg>
  </div>

  <div class="controls" id="controls">
    <h2>Interactive Mindmap</h2>

    <input id="search" class="search" placeholder="Search node text (press Enter)" />

    <div>
      <button class="btn" id="expandAll">Expand all</button>
      <button class="btn" id="collapseAll">Collapse all</button>
      <button class="btn primary" id="fitView">Fit view</button>
    </div>

    <div class="small">Tip: drag to pan, scroll (or pinch) to zoom, click nodes to expand/collapse, or open details on the right.</div>

    <div style="margin-top:12px;">
      <div class="legend"><strong>Legend</strong></div>
      <div class="small">• Click a node to toggle children • Double-click to pin/unpin detail view</div>
    </div>

    <div class="sidebar" id="sidebar">
      <div style="font-weight:700;">Node details</div>
      <div id="nodeTitle" style="margin-top:8px; font-size:15px; font-weight:600;">(click a node)</div>
      <div id="nodeMeta" class="meta">Select a node to view notes, suggested actions, or owner.</div>
      <div id="nodeExtras" class="small"></div>
    </div>

    <div class="footer">Edit the data in <code>treeData</code> inside the code to customise the map.</div>
  </div>
</div>

<script>
/* -------------------------
  SAMPLE DATA: edit here
  - label: shown on node
  - title: used in side panel
  - notes: long description (optional)
  - children: nested nodes
---------------------------*/
const treeData = {
  "label": "Entrepreneurship Charter",
  "title": "Entrepreneurship Charter",
  "notes": "High-level charter and mentor pathways",
  "children": [
    {
      "label": "Industry Mentors",
      "title": "Industry mentors (e.g. Udit)",
      "notes": "Mentors can do video announcements, campus immersions and call founders to apply.",
      "children":[
        {"label":"Video announcements","title":"Video announcements","notes":"Recorded video messages by mentors to ignite interest."},
        {"label":"Campus immersions","title":"Campus immersions","notes":"If available, mentors visit campuses for meet & greets."},
        {"label":"Call for founders","title":"Call for founders","notes":"Mentors highlight ideas they want to support & invite teams to apply."}
      ]
    },
    {
      "label": "Internal Ideathon",
      "title":"Internal Ideathon",
      "notes":"Pathway for teams to secure mentorship.",
      "children":[
        {"label":"Existing teams","title":"Existing teams","notes":"MVP/product/launch stage teams can apply."},
        {"label":"Selection","title":"Selection & mentorship","notes":"Top teams get industry mentor pairing & micro-grants."}
      ]
    },
    {
      "label":"Application Pathway",
      "title":"How to apply",
      "notes":"Steps: submit brief → evaluated → monitored",
      "children":[
        {"label":"2-page brief","title":"2-page idea brief"},
        {"label":"PoC endorsement","title":"PoC endorsement"},
        {"label":"KPIs & monitoring","title":"KPIs & monitoring"}
      ]
    }
  ]
};

/* -------------------------
    Core visualization
---------------------------*/

const svg = d3.select("#svg");
const width = document.getElementById('canvas').clientWidth;
const height = document.getElementById('canvas').clientHeight;

const g = svg.append("g").attr("transform","translate(0,0)");

let root = d3.hierarchy(treeData);
root.x0 = height / 2;
root.y0 = 0;

// collapse nodes initially except root
root.children && root.children.forEach(collapse);

const duration = 300;
const treeLayout = d3.tree().nodeSize([80, 220]); // [vertical spacing, horizontal spacing]

// zoom & pan
const zoom = d3.zoom().scaleExtent([0.2, 3])
  .on("zoom", (event) => { g.attr("transform", event.transform); });

svg.call(zoom);

// draw initial
update(root);

// fit view button to center & scale to fit
document.getElementById('fitView').addEventListener('click', fitToView);
document.getElementById('expandAll').addEventListener('click', ()=>{ expandAll(root); update(root); });
document.getElementById('collapseAll').addEventListener('click', ()=>{ collapseAll(root); update(root); });

// search
document.getElementById('search').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){
    const q = e.target.value.trim().toLowerCase();
    if(!q){ clearHighlight(); return; }
    const matches = [];
    root.each(d=>{
      if((d.data.label && d.data.label.toLowerCase().includes(q)) || (d.data.title && d.data.title.toLowerCase().includes(q))){
        matches.push(d);
      }
    });
    if(matches.length){
      // expand path to first match, center view on it & highlight
      let target = matches[0];
      expandPathTo(target);
      update(root);
      setTimeout(()=>{ centerNode(target); highlightNode(target); }, 400);
    } else {
      alert('No matches found');
    }
  }
});

function update(source) {
  // compute tree layout
  const tree = treeLayout(root);
  const nodes = tree.descendants();
  const links = tree.links();

  // normalize y positions (depth -> horiz)
  nodes.forEach(d => d.y = d.depth * 220);

  // ----- LINKS -----
  const linkSel = g.selectAll(".link").data(links, d => d.target.data.label + "-" + d.target.depth);

  const linkEnter = linkSel.enter().append("path")
    .attr("class","link")
    .attr("d", d => diagonal({source: {x: source.x0, y: source.y0}, target: {x: source.x0, y: source.y0}}))
    .style("opacity",0);

  linkSel.exit().transition().duration(duration).style("opacity",0).remove();

  const linkMerge = linkEnter.merge(linkSel);
  linkMerge.transition().duration(duration).style("opacity",1).attr("d", diagonal);

  // ----- NODES -----
  const nodeSel = g.selectAll("g.node").data(nodes, d => d.data.label + "-" + d.depth);

  const nodeEnter = nodeSel.enter().append("g")
      .attr("class","node")
      .attr("transform", d => `translate(${source.y0},${source.x0})`)
      .style("cursor","pointer")
      .on("click", (event,d)=>{ toggle(d); update(d); showDetails(d); })
      .on("dblclick", (event,d)=>{ showDetails(d, true); });

  // rectangle
  nodeEnter.append("rect")
      .attr("class","node-rect")
      .attr("width",200)
      .attr("height",40)
      .attr("x",0)
      .attr("y",-20)
      .attr("rx",8)
      .attr("ry",8);

  // title
  nodeEnter.append("text")
      .attr("class","node-text node-title")
      .attr("x",10)
      .attr("y",-2)
      .text(d => d.data.label)
      .call(wrapText, 180);

  // small subtitle (optional)
  nodeEnter.append("text")
      .attr("class","node-text smallsub")
      .attr("x",10)
      .attr("y",16)
      .attr("fill","#6b7280")
      .style("font-size","11px")
      .text(d => "");

  // update + transitions
  const nodeMerge = nodeEnter.merge(nodeSel);

  nodeMerge.transition().duration(duration)
    .attr("transform", d => `translate(${d.y},${d.x})`);

  nodeMerge.select("rect.node-rect")
    .attr("width",200)
    .attr("height", d => 40)
    .attr("x",0)
    .attr("y",-20);

  // exit
  nodeSel.exit().transition().duration(duration).attr("transform", d => `translate(${source.y},${source.x})`).remove();

  // store old positions for transition
  nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
}

// diagonal path generator (curved vertical)
function diagonal(d){
  const source = {x: d.source.x, y: d.source.y};
  const target = {x: d.target.x, y: d.target.y};
  const midY = (source.y + target.y) / 2;
  return `M ${source.y} ${source.x}
          C ${midY} ${source.x} ${midY} ${target.x} ${target.y} ${target.x}`;
}

// collapse helper
function collapse(d){
  if(d.children){
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

// expand helper
function expand(d){
  if(d._children){
    d.children = d._children;
    d.children.forEach(expand);
    d._children = null;
  }
}

function toggle(d){
  if(d.children){
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
}

function expandAll(node){
  node.children && node.children.forEach(function(c){ expandAll(c); });
  if(node._children) node.children = node._children, node._children = null;
}
function collapseAll(node){
  node.children && node.children.forEach(function(c){ collapseAll(c); });
  if(node.children) node._children = node.children, node.children = null;
}

// show details in side panel
function showDetails(d, pin=false){
  document.getElementById('nodeTitle').innerText = d.data.title || d.data.label;
  document.getElementById('nodeMeta').innerText = d.data.notes || "(no extra notes)";
  document.getElementById('nodeExtras').innerHTML = `<div class="small">Depth: ${d.depth} • Children: ${ (d.children||d._children||[]).length }</div>`;
  // highlight node
  clearHighlight();
  highlightNode(d);
  if(pin){
    // do nothing else, pinned
  } else {
    // scroll view to node
    centerNode(d);
  }
}

// center the view to a node (smooth)
function centerNode(d){
  // compute transform that centers node
  const svgRect = svg.node().getBoundingClientRect();
  const scale = 1.0;
  const x = -d.y * scale + svgRect.width / 2 - 100;
  const y = -d.x * scale + svgRect.height / 2;
  svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity.translate(x,y).scale(scale));
}

// highlight node by stroking its link/rect
function highlightNode(d){
  // highlight the rect
  g.selectAll("g.node").select("rect").classed("highlight", false);
  d3.select(d3.selectAll("g.node").nodes().find(n => {
    return (n.__data__ === d);
  })).select("rect").classed("highlight", true);
}
// clear highlight
function clearHighlight(){
  g.selectAll("rect").classed("highlight", false);
}

// expand path from root to target
function expandPathTo(target){
  let node = target;
  while(node.parent){
    if(node.parent._children) { node.parent.children = node.parent._children; node.parent._children = null; }
    node = node.parent;
  }
}

// fit to view - compute bounding box and scale/translate
function fitToView(){
  const nodes = g.selectAll("g.node").nodes();
  if(!nodes.length) return;
  let minX=1e9, minY=1e9, maxX=-1e9, maxY=-1e9;
  nodes.forEach(n => {
    const b = n.getBoundingClientRect();
    minX = Math.min(minX, b.left);
    minY = Math.min(minY, b.top);
    maxX = Math.max(maxX, b.right);
    maxY = Math.max(maxY, b.bottom);
  });
  const svgRect = svg.node().getBoundingClientRect();
  // Simple fit: reset transform
  svg.transition().duration(400).call(zoom.transform, d3.zoomIdentity.translate(20,20).scale(1));
}

// wrap long text inside node (simple)
function wrapText(selection, width){
  selection.each(function(){
    const text = d3.select(this);
    const words = text.text().split(/\s+/).reverse();
    let word;
    let line = [];
    let lineNumber = 0;
    const lineHeight = 1.1; // ems
    const x = text.attr("x");
    const y = text.attr("y");
    let tspan = text.text(null).append("tspan").attr("x", x).attr("y", y);
    while (word = words.pop()) {
      line.push(word);
      tspan.text(line.join(" "));
      if (tspan.node().getComputedTextLength() > width) {
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + "em").text(word);
      }
    }
  });
}

// clear highlight when clicking outside
svg.on("click", (event)=>{
  if(event.target.tagName === 'svg'){ clearHighlight(); }
});

/* Initialize drawing once DOM sizes are known */
function init(){
  root = d3.hierarchy(treeData);
  root.x0 = document.getElementById('canvas').clientHeight / 2;
  root.y0 = 0;
  root.children && root.children.forEach(collapse);
  update(root);
  // initial fit slightly
  setTimeout(()=>fitToView(), 400);
}
init();
</script>
</body>
</html>
